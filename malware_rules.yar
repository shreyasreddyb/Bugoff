rule detect_malware {
    meta:
        description = "Detects suspicious files containing malware indicators"
        author = "Your Name"
        date = "2023-11-15"
    strings:
        $suspicious_string = "malware" nocase
        $executable_magic = "MZ"  // Changed from { MZ } to string format
    condition:
        $suspicious_string or $executable_magic
}

rule suspicious_scripts {
    meta:
        description = "Detects common script-based malware"
    strings:
        $php_shell = "<?php system($_GET['cmd']);?>" nocase
        $js_malware = "new ActiveXObject" nocase
        $powershell = "powershell.exe -nop -w hidden -enc" nocase
    condition:
        any of them
}

rule packed_executable {
    meta:
        description = "Detects potentially packed executables"
    strings:
        $upx_header = "UPX!"
        $aspack = "ASPack"
        $fsg = "FSG!"
    condition:
        any of them
}

rule document_exploits {
    meta:
        description = "Detects malicious documents with embedded code"
    strings:
        $ole_stream = "This program cannot be run in DOS mode" wide
        $vba_macro = "Sub AutoOpen()" nocase
        $office_exploit = "bin.base64" nocase
    condition:
        any of them
}

rule ransomware_patterns {
    meta:
        description = "Detects common ransomware strings"
    strings:
        $wannacry = "WANACRY!" wide
        $locky = "Locky" wide
        $revil = "REvil" wide
    condition:
        any of them
}

rule linux_malware {
    meta:
        description = "Detects common Linux malware patterns"
    strings:
        $elf_header = { 7F 45 4C 46 }  // ELF file header
        $bash_reverse_shell = "/bin/bash -i >& /dev/tcp/" nocase
        $rootkit = "rootkit" nocase
    condition:
        $elf_header and any of ($bash_reverse_shell, $rootkit)
}

rule webshells {
    meta:
        description = "Detects common web shell patterns"
    strings:
        $c99 = "<?php @eval($_POST['cmd']);?>" nocase
        $b374k = "b374k shell" nocase
        $webadmin = "WebShell" nocase
    condition:
        any of them
}
